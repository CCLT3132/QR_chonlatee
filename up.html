<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - Ultra Minimal</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 650px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h2 {
      color: #667eea;
      text-align: center;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .info-box {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 25px;
      border-left: 4px solid #2196f3;
    }
    .info-box h3 {
      color: #1976d2;
      font-size: 16px;
      margin-bottom: 8px;
    }
    .info-box p {
      color: #555;
      font-size: 13px;
      line-height: 1.6;
    }
    .info-box code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      color: #d32f2f;
    }
    
    .warning-box {
      background: #e8f5e9;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #4caf50;
    }
    .warning-box h4 {
      color: #2e7d32;
      margin-bottom: 8px;
    }
    .warning-box p {
      color: #2e7d32;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 8px;
    }
    .warning-box ul {
      margin-left: 20px;
      color: #2e7d32;
      font-size: 13px;
    }
    .warning-box li {
      margin-bottom: 5px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    .required {
      color: #f44336;
    }
    input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    small {
      display: block;
      margin-top: 5px;
      color: #666;
      font-size: 12px;
    }
    .char-counter {
      float: right;
      font-size: 11px;
      margin-left: 10px;
    }
    .char-counter.ok {
      color: #4caf50;
    }
    .char-counter.warning {
      color: #ff9800;
      font-weight: bold;
    }
    .char-counter.error {
      color: #f44336;
      font-weight: bold;
    }
    
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    
    #qrSection {
      margin-top: 30px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 15px;
      text-align: center;
      display: none;
    }
    #qrSection.show {
      display: block;
    }
    
    .qr-stats {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: left;
    }
    .qr-stats h4 {
      color: #667eea;
      margin-bottom: 15px;
      text-align: center;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    .stat-row:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: #666;
      font-weight: 600;
    }
    .stat-value {
      color: #333;
      font-weight: bold;
    }
    .complexity-bar {
      width: 100%;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 5px;
    }
    .complexity-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #ff9800, #f44336);
      transition: width 0.3s;
    }
    
    #qrcode {
      display: inline-block;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .qr-info {
      color: #28a745;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 15px;
    }
    .download-btn {
      margin-top: 15px;
      padding: 12px 30px;
      background: #28a745;
      width: auto;
      display: inline-block;
    }
    .download-btn:hover {
      background: #218838;
      box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
    }
    
    .message {
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .test-url {
      margin-top: 20px;
      padding: 15px;
      background: #fff3cd;
      border-radius: 10px;
      border: 1px solid #ffc107;
    }
    .test-url h4 {
      color: #856404;
      margin-bottom: 10px;
    }
    .test-url a {
      color: #0066cc;
      word-break: break-all;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì± ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
    <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏∏‡∏î - Error Level L (7%)</p>
    
    <div class="info-box">
      <h3>üìå ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
      <p>
        <strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1:</strong> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå <code>employee_qr.html</code> ‡∏Ç‡∏∂‡πâ‡∏ô GitHub Pages<br>
        <strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2:</strong> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ bit.ly ‡∏¢‡πà‡∏≠ URL)<br>
        <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> <code>https://bit.ly/emp-qr</code>
      </p>
    </div>

    <div class="warning-box">
      <h4>‚ö° ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ QR Code ‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏∏‡∏î</h4>
      <p><strong>‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß:</strong></p>
      <ul>
        <li>‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå 1 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (i, n, k, t, p, l, g)</li>
        <li>‡∏ï‡∏±‡πâ‡∏á LINE ID ‡πÄ‡∏õ‡πá‡∏ô @chonlatee ‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß</li>
        <li>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏µ‡∏î)</li>
        <li>‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î)</li>
        <li>‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î base64 URL-safe + ‡∏•‡∏ö padding</li>
        <li>Error Level: L (7% - ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î)</li>
      </ul>
      <p style="margin-top:10px"><strong>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> URL ‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Üí QR Code ‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å üü¢</p>
    </div>

    <div class="form-group">
      <label>URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏Æ‡∏™‡∏ï‡∏¥‡πâ‡∏á <span class="required">*</span></label>
      <input type="url" id="hosting_url" placeholder="https://bit.ly/emp-qr">
      <small>üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÉ‡∏ä‡πâ bit.ly ‡∏¢‡πà‡∏≠ URL ‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</small>
    </div>

    <div class="form-group">
      <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
      <input type="text" id="emp_id" placeholder="123456789" maxlength="9">
      <small>‚ö†Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-9 ‡∏´‡∏•‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <div class="form-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input type="text" id="fullname" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" maxlength="40">
      <small>‚ö†Ô∏è 0-40 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <div class="form-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
      <input type="text" id="nickname" placeholder="‡∏ä‡∏≤‡∏¢" maxlength="15">
      <small>‚ö†Ô∏è 0-15 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <div class="form-group">
      <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
      <input type="text" id="position" placeholder="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢" maxlength="20">
      <small>‚ö†Ô∏è 0-20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <div class="form-group">
      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="phone" placeholder="0812345678" maxlength="10" pattern="[0-9]*">
      <small>‚ö†Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-10 ‡∏´‡∏•‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏µ‡∏î, ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <div class="form-group">
      <label>
        URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        <span class="char-counter" id="photoCounter">0</span>
      </label>
      <input type="url" id="photo_url" placeholder="https://bit.ly/pic123" oninput="updatePhotoCounter()">
      <small>üí° 0-40 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ - ‡πÉ‡∏ä‡πâ bit.ly ‡∏¢‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
    </div>

    <button onclick="generateQR()">üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>
    
    <div id="message"></div>
    
    <div id="qrSection">
      <div class="qr-stats">
        <h4>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ QR Code</h4>
        <div class="stat-row">
          <span class="stat-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
          <span class="stat-value" id="dataSize">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">‡∏Ç‡∏ô‡∏≤‡∏î URL:</span>
          <span class="stat-value" id="urlSize">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Error Level:</span>
          <span class="stat-value">L (7%)</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô:</span>
          <span class="stat-value" id="complexityText">‡∏ï‡πà‡∏≥</span>
        </div>
        <div class="complexity-bar">
          <div class="complexity-fill" id="complexityBar"></div>
        </div>
      </div>
      
      <div id="qrcode"></div>
      <div class="qr-info">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
      <button class="download-btn" onclick="downloadQR()">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code</button>
      
      <div class="test-url">
        <h4>üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå:</h4>
        <a id="testLink" href="#" target="_blank">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</a>
      </div>
    </div>
  </div>

  <script>
    let currentCanvas = null;

    function updatePhotoCounter() {
      const photoUrl = document.getElementById("photo_url").value;
      const counter = document.getElementById("photoCounter");
      const length = photoUrl.length;
      
      if (length === 0) {
        counter.textContent = '0';
        counter.className = 'char-counter';
      } else if (length <= 25) {
        counter.textContent = `${length} ‚úì‚úì‚úì`;
        counter.className = 'char-counter ok';
      } else if (length <= 40) {
        counter.textContent = `${length} ‚úì`;
        counter.className = 'char-counter ok';
      } else {
        counter.textContent = `${length} ‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô`;
        counter.className = 'char-counter warning';
      }
    }

    function convertGoogleDriveLink(url) {
      if (!url) return '';
      
      if (url.includes('drive.google.com')) {
        let match = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[1]}&sz=w200`;
        }
        
        match = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[1]}&sz=w200`;
        }
        
        match = url.match(/([a-zA-Z0-9_-]{25,})/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[0]}&sz=w200`;
        }
      }
      
      return url;
    }

    function generateQR() {
      const hostingUrl = document.getElementById("hosting_url").value.trim();
      const empId = document.getElementById("emp_id").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const nickname = document.getElementById("nickname").value.trim();
      const position = document.getElementById("position").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const photoUrl = document.getElementById("photo_url").value.trim();

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ URL ‡πÇ‡∏Æ‡∏™‡∏ï‡∏¥‡πâ‡∏á (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
      if (!hostingUrl) {
        showMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏Æ‡∏™‡∏ï‡∏¥‡πâ‡∏á", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (empId && (empId.length > 9 || !/^\d+$/.test(empId))) {
        showMessage("‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-9 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (fullname && fullname.length > 40) {
        showMessage("‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 40 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (nickname && nickname.length > 15) {
        showMessage("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (position && position.length > 20) {
        showMessage("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (phone && (phone.length > 10 || !/^\d+$/.test(phone))) {
        showMessage("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "error");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å)
      if (photoUrl && photoUrl.length > 40) {
        showMessage("URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 40 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÉ‡∏ä‡πâ bit.ly ‡∏¢‡πà‡∏≠ URL)", "error");
        return;
      }

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Google Drive (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô)
      const convertedPhotoUrl = photoUrl ? convertGoogleDriveLink(photoUrl) : '';

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤)
      const data = {};
      
      if (empId) data.i = empId;
      if (fullname) data.n = fullname;
      if (nickname) data.k = nickname;
      if (position) data.t = position;
      if (phone) data.p = phone;
      data.l = "@chonlatee"; // ‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏™‡∏°‡∏≠
      if (convertedPhotoUrl) data.g = convertedPhotoUrl;

      // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      const jsonData = JSON.stringify(data);
      
      // ‡πÉ‡∏ä‡πâ base64 ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö padding ‡πÅ‡∏•‡∏∞ URL-unsafe chars
      let encoded = btoa(unescape(encodeURIComponent(jsonData)))
        .replace(/=+$/, '')        // ‡∏•‡∏ö padding
        .replace(/\+/g, '-')       // ‡πÅ‡∏ó‡∏ô + ‡∏î‡πâ‡∏ß‡∏¢ -
        .replace(/\//g, '_');      // ‡πÅ‡∏ó‡∏ô / ‡∏î‡πâ‡∏ß‡∏¢ _
      
      const qrUrl = `${hostingUrl}#${encoded}`;

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
      const dataSize = jsonData.length;
      const urlSize = qrUrl.length;
      
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (0-100%)
      let complexity = 0;
      let complexityText = '';
      if (urlSize <= 80) {
        complexity = 12;
        complexityText = '‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å üü¢üü¢üü¢';
      } else if (urlSize <= 120) {
        complexity = 20;
        complexityText = '‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å üü¢üü¢';
      } else if (urlSize <= 180) {
        complexity = 35;
        complexityText = '‡∏ï‡πà‡∏≥ üü¢';
      } else if (urlSize <= 250) {
        complexity = 50;
        complexityText = '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üü°';
      } else if (urlSize <= 350) {
        complexity = 70;
        complexityText = '‡∏™‡∏π‡∏á üü†';
      } else {
        complexity = 100;
        complexityText = '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å üî¥';
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
      document.getElementById("dataSize").textContent = `${dataSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
      document.getElementById("urlSize").textContent = `${urlSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
      document.getElementById("complexityText").textContent = complexityText;
      document.getElementById("complexityBar").style.width = complexity + '%';

      // ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö
      document.getElementById("testLink").href = qrUrl;
      document.getElementById("testLink").textContent = qrUrl;

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
      const qrcodeDiv = document.getElementById("qrcode");
      qrcodeDiv.innerHTML = "";
      
      try {
        new QRCode(qrcodeDiv, {
          text: qrUrl,
          width: 300,
          height: 300,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.L,  // Error Level L (7%)
          quietZone: 2,
          quietZoneColor: "#ffffff"
        });
        
        document.getElementById("qrSection").classList.add("show");
        showMessage(`QR Code ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏ô‡∏≤‡∏î ${urlSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (${complexityText})`, "success");
        
        setTimeout(() => {
          currentCanvas = qrcodeDiv.querySelector('canvas');
        }, 100);
        
      } catch (e) {
        showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message, "error");
      }
    }

    function downloadQR() {
      if (currentCanvas) {
        const empId = document.getElementById("emp_id").value.trim();
        const link = document.createElement('a');
        link.download = `QR_${empId || 'employee'}.png`;
        link.href = currentCanvas.toDataURL();
        link.click();
      }
    }

    function showMessage(text, type) {
      const msgDiv = document.getElementById("message");
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = text;
      setTimeout(() => {
        msgDiv.className = 'message';
        msgDiv.textContent = '';
      }, 5000);
    }
  </script>
</body>
</html>