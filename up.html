<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 650px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h2 {
      color: #667eea;
      text-align: center;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .info-box {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 25px;
      border-left: 4px solid #2196f3;
    }
    .info-box h3 {
      color: #1976d2;
      font-size: 16px;
      margin-bottom: 8px;
    }
    .info-box p {
      color: #555;
      font-size: 13px;
      line-height: 1.6;
    }
    .info-box code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      color: #d32f2f;
    }
    
    .warning-box {
      background: #fff3cd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #ffc107;
    }
    .warning-box h4 {
      color: #856404;
      margin-bottom: 8px;
    }
    .warning-box p {
      color: #856404;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 8px;
    }
    .warning-box ul {
      margin-left: 20px;
      color: #856404;
      font-size: 13px;
    }
    .warning-box li {
      margin-bottom: 5px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    .required {
      color: #f44336;
    }
    input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    small {
      display: block;
      margin-top: 5px;
      color: #666;
      font-size: 12px;
    }
    .char-counter {
      float: right;
      font-size: 11px;
      margin-left: 10px;
    }
    .char-counter.ok {
      color: #4caf50;
    }
    .char-counter.warning {
      color: #ff9800;
      font-weight: bold;
    }
    .char-counter.error {
      color: #f44336;
      font-weight: bold;
    }
    
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    
    #qrSection {
      margin-top: 30px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 15px;
      text-align: center;
      display: none;
    }
    #qrSection.show {
      display: block;
    }
    
    .qr-stats {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: left;
    }
    .qr-stats h4 {
      color: #667eea;
      margin-bottom: 15px;
      text-align: center;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    .stat-row:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: #666;
      font-weight: 600;
    }
    .stat-value {
      color: #333;
      font-weight: bold;
    }
    .complexity-bar {
      width: 100%;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 5px;
    }
    .complexity-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #ff9800, #f44336);
      transition: width 0.3s;
    }
    
    #qrcode {
      display: inline-block;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .qr-info {
      color: #28a745;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 15px;
    }
    .download-btn {
      margin-top: 15px;
      padding: 12px 30px;
      background: #28a745;
      width: auto;
      display: inline-block;
    }
    .download-btn:hover {
      background: #218838;
      box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
    }
    
    .message {
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .test-url {
      margin-top: 20px;
      padding: 15px;
      background: #fff3cd;
      border-radius: 10px;
      border: 1px solid #ffc107;
    }
    .test-url h4 {
      color: #856404;
      margin-bottom: 10px;
    }
    .test-url a {
      color: #0066cc;
      word-break: break-all;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì± ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
    <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å - Error Level L (7%)</p>
    
    <div class="info-box">
      <h3>üìå ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
      <p>
        <strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1:</strong> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå <code>employee_qr.html</code> ‡∏Ç‡∏∂‡πâ‡∏ô GitHub Pages<br>
        <strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2:</strong> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á<br>
        <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> <code>https://user.github.io/repo/employee_qr.html</code>
      </p>
    </div>

    <div class="warning-box">
      <h4>‚ö° ‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô QR Code</h4>
      <p><strong>‚úÖ ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß:</strong></p>
      <ul>
        <li>‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ (i, n, nn, d, p, dp, ph, e, l, img)</li>
        <li>‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
        <li>Error Level: L (7% - ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î)</li>
      </ul>
      <p style="margin-top:10px"><strong>üí° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</strong> URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡πâ‡∏ô ‚â§ 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÉ‡∏ä‡πâ bit.ly, i.imgur.com)</p>
    </div>

    <div class="form-group">
      <label>URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏Æ‡∏™‡∏ï‡∏¥‡πâ‡∏á <span class="required">*</span></label>
      <input type="url" id="hosting_url" placeholder="https://user.github.io/repo/employee_qr.html">
      <small>‚ö†Ô∏è URL ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå employee_qr.html ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß</small>
    </div>

    <div class="form-group">
      <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
      <input type="text" id="emp_id" placeholder="EMP001" maxlength="20">
    </div>

    <div class="form-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
      <input type="text" id="fullname" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" maxlength="50">
    </div>

    <div class="form-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
      <input type="text" id="nickname" placeholder="‡∏ä‡∏≤‡∏¢" maxlength="20">
    </div>

    <div class="form-group">
      <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</label>
      <input type="date" id="startdate">
    </div>

    <div class="form-group">
      <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</label>
      <input type="text" id="position" placeholder="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢" maxlength="30">
    </div>

    <div class="form-group">
      <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
      <input type="text" id="department" placeholder="‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢" maxlength="30">
    </div>

    <div class="form-group">
      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="phone" placeholder="081-234-5678" maxlength="15">
    </div>

    <div class="form-group">
      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
      <input type="email" id="email" placeholder="user@company.com" maxlength="40">
    </div>

    <div class="form-group">
      <label>LINE ID</label>
      <input type="text" id="lineid" placeholder="@username" maxlength="30">
    </div>

    <div class="form-group">
      <label>
        URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        <span class="char-counter" id="photoCounter">0</span>
      </label>
      <input type="url" id="photo_url" placeholder="https://i.imgur.com/abc.jpg ‡∏´‡∏£‡∏∑‡∏≠ https://bit.ly/xyz" oninput="updatePhotoCounter()">
      <small>üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÉ‡∏ä‡πâ URL ‡∏™‡∏±‡πâ‡∏ô (bit.ly, i.imgur.com) ‡∏´‡∏£‡∏∑‡∏≠ Google Drive</small>
    </div>

    <button onclick="generateQR()">üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>
    
    <div id="message"></div>
    
    <div id="qrSection">
      <div class="qr-stats">
        <h4>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ QR Code</h4>
        <div class="stat-row">
          <span class="stat-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
          <span class="stat-value" id="dataSize">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">‡∏Ç‡∏ô‡∏≤‡∏î URL:</span>
          <span class="stat-value" id="urlSize">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Error Level:</span>
          <span class="stat-value">L (7%)</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô:</span>
          <span class="stat-value" id="complexityText">‡∏ï‡πà‡∏≥</span>
        </div>
        <div class="complexity-bar">
          <div class="complexity-fill" id="complexityBar"></div>
        </div>
      </div>
      
      <div id="qrcode"></div>
      <div class="qr-info">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
      <button class="download-btn" onclick="downloadQR()">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code</button>
      
      <div class="test-url">
        <h4>üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå:</h4>
        <a id="testLink" href="#" target="_blank">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</a>
      </div>
    </div>
  </div>

  <script>
    let currentCanvas = null;

    function updatePhotoCounter() {
      const photoUrl = document.getElementById("photo_url").value;
      const counter = document.getElementById("photoCounter");
      const length = photoUrl.length;
      
      if (length === 0) {
        counter.textContent = '0';
        counter.className = 'char-counter';
      } else if (length <= 50) {
        counter.textContent = `${length} ‚úì`;
        counter.className = 'char-counter ok';
      } else if (length <= 80) {
        counter.textContent = `${length} ‚ö†Ô∏è`;
        counter.className = 'char-counter warning';
      } else {
        counter.textContent = `${length} ‚ùå`;
        counter.className = 'char-counter error';
      }
    }

    function convertGoogleDriveLink(url) {
      if (!url) return '';
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (url.includes('drive.google.com')) {
        // ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1: https://drive.google.com/file/d/FILE_ID/view
        let match = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[1]}&sz=w200`;
        }
        
        // ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2: https://drive.google.com/open?id=FILE_ID
        match = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[1]}&sz=w200`;
        }
        
        // ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3: ‡∏°‡∏µ‡πÅ‡∏ï‡πà FILE_ID
        match = url.match(/([a-zA-Z0-9_-]{25,})/);
        if (match) {
          return `https://drive.google.com/thumbnail?id=${match[0]}&sz=w200`;
        }
      }
      
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Google Drive ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏¥‡∏°
      return url;
    }

    function generateQR() {
      const hostingUrl = document.getElementById("hosting_url").value.trim();
      const empId = document.getElementById("emp_id").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const nickname = document.getElementById("nickname").value.trim();
      const startdate = document.getElementById("startdate").value;
      const position = document.getElementById("position").value.trim();
      const department = document.getElementById("department").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const lineid = document.getElementById("lineid").value.trim();
      const photoUrl = document.getElementById("photo_url").value.trim();

      if (!hostingUrl) {
        showMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏Æ‡∏™‡∏ï‡∏¥‡πâ‡∏á", "error");
        return;
      }

      if (!empId || !fullname) {
        showMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", "error");
        return;
      }

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Google Drive
      const convertedPhotoUrl = convertGoogleDriveLink(photoUrl);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ (‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡∏±‡πâ‡∏ô‡πÜ)
      const data = {
        i: empId,           // id
        n: fullname,        // name
        nn: nickname,       // nickname
        d: startdate,       // date
        p: position,        // position
        dp: department,     // department
        ph: phone,          // phone
        e: email,           // email
        l: lineid,          // line
        img: convertedPhotoUrl  // image
      };

      // ‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å (‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
      Object.keys(data).forEach(key => {
        if (!data[key]) delete data[key];
      });

      // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      const jsonData = JSON.stringify(data);
      const encoded = btoa(encodeURIComponent(jsonData));
      const qrUrl = `${hostingUrl}#${encoded}`;

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
      const dataSize = jsonData.length;
      const urlSize = qrUrl.length;
      
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (0-100%)
      let complexity = 0;
      let complexityText = '';
      if (urlSize <= 150) {
        complexity = 25;
        complexityText = '‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å üü¢';
      } else if (urlSize <= 250) {
        complexity = 40;
        complexityText = '‡∏ï‡πà‡∏≥ üü¢';
      } else if (urlSize <= 350) {
        complexity = 60;
        complexityText = '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üü°';
      } else if (urlSize <= 450) {
        complexity = 80;
        complexityText = '‡∏™‡∏π‡∏á üü†';
      } else {
        complexity = 100;
        complexityText = '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å üî¥';
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
      document.getElementById("dataSize").textContent = `${dataSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
      document.getElementById("urlSize").textContent = `${urlSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
      document.getElementById("complexityText").textContent = complexityText;
      document.getElementById("complexityBar").style.width = complexity + '%';

      // ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö
      document.getElementById("testLink").href = qrUrl;
      document.getElementById("testLink").textContent = qrUrl;

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
      const qrcodeDiv = document.getElementById("qrcode");
      qrcodeDiv.innerHTML = "";
      
      try {
        new QRCode(qrcodeDiv, {
          text: qrUrl,
          width: 300,
          height: 300,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.L  // Error Level L (7%)
        });
        
        document.getElementById("qrSection").classList.add("show");
        showMessage(`QR Code ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏ô‡∏≤‡∏î ${urlSize} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (${complexityText})`, "success");
        
        setTimeout(() => {
          currentCanvas = qrcodeDiv.querySelector('canvas');
        }, 100);
        
      } catch (e) {
        showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message, "error");
      }
    }

    function downloadQR() {
      if (currentCanvas) {
        const empId = document.getElementById("emp_id").value.trim();
        const link = document.createElement('a');
        link.download = `QR_${empId || 'employee'}.png`;
        link.href = currentCanvas.toDataURL();
        link.click();
      }
    }

    function showMessage(text, type) {
      const msgDiv = document.getElementById("message");
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = text;
      setTimeout(() => {
        msgDiv.className = 'message';
        msgDiv.textContent = '';
      }, 5000);
    }
  </script>
</body>
</html>